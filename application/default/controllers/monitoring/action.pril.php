<?php$rus = array('января', 'февраля', 'марта', 'апреля', 'мая', 'июня', 'июля', 'августа', 'сентября', 'октября', 'ноября', 'декабря');$fileContent = file_get_contents(DOGOVOR_DIR.'/pril.rtf');$twxt2 = new AK_Article_Item();$twxt2->loadByRewriteName('monitoringpril');$rowContent = strip_tags($twxt2->getContent());$settings = new AK_Order_Settings();if (!empty($this->_user->dogovorNotifyFlag)) {    $fileContent = str_replace('XXX12', $this->_user->dolj.' __________ '.$this->_user->df.' '.$this->_user->di.' '.$this->_user->do, $fileContent);}else {    $fileContent = str_replace('XXX12', '', $fileContent);}$fileContent = str_replace('XXX11', 'Директор '.$settings->get('gendirector'), $fileContent);$fileContent = str_replace('XXX1', 'М/'.date('y').$this->_user->id.' от '.date('d').' '.$rus[date('m')-1].' 201'.(date('y')-10).'г.', $fileContent);$fileContent = str_replace('XXXX19', $settings->get('gendirector'), $fileContent);$fileContent = str_replace('XXXX20', $settings->get('glavbuh'), $fileContent);$fileContent = str_replace('XXXTEXT2XXX', $rowContent, $fileContent);//$tmpfname = tempnam(INVOICE_DIR."/tmp", "DOG_");//$handle = fopen($tmpfname, "w");//fwrite($handle, iconv("UTF-8", "CP1251", $fileContent));//fwrite($handle, $fileContent);//fclose($handle);Header('Content-Type: application/rtf');header("Content-Disposition:attachment;filename=pril.rtf");//readfile($tmpfname);echo iconv("UTF-8", "CP1251", $fileContent);die;//unlink($tmpfname);exit();